name: Lean Build

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Install elan
      run: |
        curl https://raw.githubusercontent.com/leanprover/elan/master/elan-init.sh -sSf | sh -s -- -y --default-toolchain none
        echo "$HOME/.elan/bin" >> $GITHUB_PATH

    - name: Get Mathlib cache
      run: lake exe cache get || true

    - name: Build
      run: lake build

    - name: Verify no sorry
      run: |
        if grep -r "sorry" DefectCRN/*.lean DefectCRN/**/*.lean 2>/dev/null; then
          echo "âŒ ERROR: Found 'sorry' in codebase"
          exit 1
        else
          echo "âœ… No 'sorry' found - all proofs complete"
        fi

    - name: Line count
      run: |
        echo "ðŸ“Š Line counts:"
        wc -l DefectCRN/*.lean DefectCRN/**/*.lean 2>/dev/null || wc -l DefectCRN/*.lean
